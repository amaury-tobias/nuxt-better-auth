---
title: Common Patterns
description: Handy recipes for real-world auth flows.
---

## Preserve Redirect After Login

```vue [pages/login.vue]
<script setup lang="ts">
definePageMeta({ auth: 'guest' })
const { signIn } = useUserSession()
const route = useRoute()

// Validate redirect URL to prevent open redirect attacks
function getSafeRedirect() {
  const redirect = route.query.redirect as string

  if (!redirect) return '/'
  if (!redirect.startsWith('/')) return '/'
  if (redirect.startsWith('//')) return '/'

  return redirect
}

async function login(email: string, password: string) {
  await signIn.email({
    email,
    password,
    onSuccess: () => navigateTo(getSafeRedirect()),
  })
}
</script>
```

::warning
Always validate redirect URLs. Accepting arbitrary URLs allows attackers to redirect users to malicious sites after login.
::

## Role-Based Navigation

```vue
<template>
  <nav v-if="loggedIn">
    <NuxtLink to="/dashboard">Home</NuxtLink>
    <NuxtLink v-if="user?.role === 'admin'" to="/admin">Admin</NuxtLink>
  </nav>
</template>

<script setup lang="ts">
const { user, loggedIn } = useUserSession()
</script>
```

## Session Refresh Button

```vue
<script setup lang="ts">
const { fetchSession, ready } = useUserSession()
</script>

<template>
  <button :disabled="!ready" @click="fetchSession({ force: true })">
    Refresh session
  </button>
</template>
```

## Remember Me

Use Better Authâ€™s `session.cookie.maxAge` to control persistence:

```ts [auth.config.ts]
export default defineServerAuth(() => ({
  session: {
    cookie: {
      maxAge: 60 * 60 * 24 * 7, // 7 days
    },
  },
}))
```

## Session Expiry Warning

```ts [composables/useSessionWarning.ts]
import { useUserSession } from '#imports'

export function useSessionWarning() {
  const { session } = useUserSession()

  watch(
    () => session.value?.expiresAt,
    (expiresAt) => {
      if (!expiresAt) return
      const msLeft = new Date(expiresAt).getTime() - Date.now()
      if (msLeft < 5 * 60 * 1000) {
        // show toast/snackbar
      }
    },
    { immediate: true },
  )
}
```

Call `useSessionWarning()` in layouts to notify users.

::note
`session.expiresAt` is only available when using database sessions. JWE (database-less) sessions don't include this field. Check your Better Auth configuration.
::
